---
layout: post
title: Haskell's WebDriver package is back in business
tags: [haskell]
---

## TL;DR

The [webdriver](https://hackage.haskell.org/package/webdriver) package has undergone some major changes and now supports Selenium 3 and 4!

## Some history

This project has been on autopilot for a while now. Originally written by [@erratic-pattern](https://github.com/erratic-pattern), the library spoke the Selenium JSON wire protocol for controlling browsers via Selenium 2. However, the world began to change when Selenium 3 came out, with support for a new [W3C protocol](https://www.w3.org/TR/webdriver2/) with some notable new features like [Action chains](https://www.w3.org/TR/webdriver2/#dfn-actions).

Then Selenium 4 came out, which marked the legacy wire protocol as deprecated. It was time for some major updates to keep this package compatible.

As a heavy user of this package, I got Hackage maintainer access in November 2022 to help keep it running, making small tweaks to support dependency updates and new GHC versions etc. In April 2023 we got the [haskell-webdriver](https://github.com/haskell-webdriver) organization created on GitHub as the new home of the project. That year [@dten](https://github.com/dten) made a couple nice contributions.

The push towards real progress was started by [PR #144](https://github.com/haskell-webdriver/haskell-webdriver/pull/144), which was actualy first opened by [@cfraz89](https://github.com/cfraz89) in 2018. This PR updated some API calls and data structures to use W3C-compatible versions, and served as a starting point when I began trying to do the upgrade in earnest.

In the rest of this blog post I'll mention some interesting aspects of this update, for posterity's sake and hopefully to inspire some people to migrate to the new version and use the package.

## Process lifecycle management



## Tests!

The original package didn't have any tests.

## Cleaning up some module proliferation

## Simpler `Test.WebDriver.Profile`

## MonadBaseControl -> MonadUnliftIO

The monad design of the original package looked like this:

```haskell
-- |A class for monads that carry a WebDriver session with them. The
-- MonadBaseControl superclass is used for exception handling through
-- the lifted-base package.
class (Monad m, Applicative m) => WDSessionState m where

  -- |Retrieves the current session state of the monad
  getSession :: m WDSession

  -- |Sets a new session state for the monad
  putSession :: WDSession -> m ()

type WDSessionStateControl s = (WDSessionState s, MonadBaseControl IO s)

class (WDSessionStateControl wd) => WebDriver wd where
  doCommand :: (HasCallStack, ToJSON a, FromJSON b) =>
                   Method      -- ^HTTP request method
                -> Text        -- ^URL of request
                -> a           -- ^JSON parameters passed in the body
                               -- of the request. Note that, as a special case,
                               -- anything that converts to Data.Aeson.Null will
                               -- result in an empty request body.
                -> wd b        -- ^The JSON result of the HTTP request.
```

## Fewer modules

## Browser process management
